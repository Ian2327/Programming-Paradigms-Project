{% extends "./base_page.html" %}
{% block content %}

<div class="container">
    <div class="login-container">
        <br/>
        <h2 class="text-center mb-4">Create Listing</h2>
        
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            {{ parentForm.as_p }}

            {{ factoryForm.management_form }}
            <div id="image-formset-container">
                {% for form in factoryForm %}
                <div class="form-group">
                    {{ form.as_p }}
                </div>
                {% endfor %}
            </div>

            <button type="button" id="add-image-form" class="btn btn-secondary">Add Another Image</button>
            <button type="submit" class="btn btn-primary">Create Listing</button>
        </form>
        <br/>
    </div>
</div>

<script>
    const imageFormContainer = document.getElementById('image-formset-container');
    const totalForms = document.getElementById('id_image_set-TOTAL_FORMS');
    const addImageButton = document.getElementById('add-image-form');
    let formNum = imageFormContainer.querySelectorAll('.form-group').length;

    function addImageForm() {
        const newForm = document.createElement('div');
        newForm.classList.add('form-group');
        newForm.innerHTML = `
            <p><label for="id_image_set-${formNum}-image">Image:</label> <input type="file" name="image_set-${formNum}-image" id="id_image_set-${formNum}-image" class="form-control"></p>
            <p><label for="id_image_set-${formNum}-DELETE">Delete:</label> <input type="checkbox" name="image_set-${formNum}-DELETE" id="id_image_set-${formNum}-DELETE"></p>
        `;
        imageFormContainer.appendChild(newForm);
        formNum++;
        totalForms.value = formNum;
    }

    addImageButton.addEventListener('click', addImageForm);
</script>

{% endblock %}
{% block currPage %}"sellTab"{% endblock %}
